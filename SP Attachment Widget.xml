<?xml version="1.0" encoding="UTF-8"?>
<unload unload_date="2016-09-07 19:32:14">
<sys_remote_update_set action="INSERT_OR_UPDATE">
<application display_value="Global">global</application>
<application_name>Global</application_name>
<application_scope>global</application_scope>
<application_version/>
<collisions/>
<commit_date/>
<deleted/>
<description/>
<inserted/>
<name>Attachment Widget</name>
<origin_sys_id/>
<release_date/>
<remote_sys_id>d042fe14db31220009247e7dbf961979</remote_sys_id>
<state>loaded</state>
<summary/>
<sys_class_name>sys_remote_update_set</sys_class_name>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2016-09-07 19:32:14</sys_created_on>
<sys_id>10d053dcdb31220009247e7dbf961988</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2016-09-07 19:32:14</sys_updated_on>
<update_set display_value=""/>
<update_source display_value=""/>
<updated/>
</sys_remote_update_set>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="Global">global</application>
<category>customer</category>
<comments/>
<name>sp_instance_63727254db31220009247e7dbf961949</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_instance"><sp_instance action="INSERT_OR_UPDATE"><active>true</active><class_name/><color>default</color><css/><glyph/><id/><order>1</order><short_description/><size>md</size><sp_column display_value="1">eb727254db31220009247e7dbf961948</sp_column><sp_widget display_value="Attachments">2b72b2d0db31220009247e7dbf96193b</sp_widget><sys_class_name>sp_instance</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-09-07 17:19:45</sys_created_on><sys_customer_update>true</sys_customer_update><sys_id>63727254db31220009247e7dbf961949</sys_id><sys_mod_count>0</sys_mod_count><sys_name/><sys_package display_value="Global" source="global">global</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>sp_instance_63727254db31220009247e7dbf961949</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-09-07 17:19:45</sys_updated_on><title/><url/><widget_parameters/></sp_instance></record_update>]]></payload>
<remote_update_set display_value="Attachment Widget">10d053dcdb31220009247e7dbf961988</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2016-09-07 19:32:14</sys_created_on>
<sys_id>14d053dcdb31220009247e7dbf961988</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2016-09-07 19:32:14</sys_updated_on>
<table/>
<target_name/>
<type>Instance</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="Global">global</application>
<category>customer</category>
<comments/>
<name>sp_page_ef72b2d0db31220009247e7dbf96193b</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_page"><sp_page action="INSERT_OR_UPDATE"><css/><id>attachments</id><internal>false</internal><public>false</public><roles/><short_description/><sys_class_name>sp_page</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-09-07 17:19:45</sys_created_on><sys_customer_update>true</sys_customer_update><sys_id>ef72b2d0db31220009247e7dbf96193b</sys_id><sys_mod_count>0</sys_mod_count><sys_name>attachments</sys_name><sys_package display_value="Global" source="global">global</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>sp_page_ef72b2d0db31220009247e7dbf96193b</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-09-07 17:19:45</sys_updated_on><title>Attachments- Test Page</title></sp_page></record_update>]]></payload>
<remote_update_set display_value="Attachment Widget">10d053dcdb31220009247e7dbf961988</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2016-09-07 19:32:14</sys_created_on>
<sys_id>54d053dcdb31220009247e7dbf961988</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2016-09-07 19:32:14</sys_updated_on>
<table/>
<target_name>attachments</target_name>
<type>Page</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="Global">global</application>
<category>customer</category>
<comments/>
<name>sp_column_eb727254db31220009247e7dbf961948</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_column"><sp_column action="INSERT_OR_UPDATE"><class_name/><order>1</order><size>12</size><size_lg/><size_sm/><size_xs/><sp_row display_value="1">67727254db31220009247e7dbf961948</sp_row><sys_class_name>sp_column</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-09-07 17:19:45</sys_created_on><sys_customer_update>true</sys_customer_update><sys_id>eb727254db31220009247e7dbf961948</sys_id><sys_mod_count>0</sys_mod_count><sys_name>1</sys_name><sys_package display_value="Global" source="global">global</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>sp_column_eb727254db31220009247e7dbf961948</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-09-07 17:19:45</sys_updated_on></sp_column></record_update>]]></payload>
<remote_update_set display_value="Attachment Widget">10d053dcdb31220009247e7dbf961988</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2016-09-07 19:32:14</sys_created_on>
<sys_id>90d053dcdb31220009247e7dbf961988</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2016-09-07 19:32:14</sys_updated_on>
<table/>
<target_name>1</target_name>
<type>Column</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="Global">global</application>
<category>customer</category>
<comments/>
<name>sp_row_67727254db31220009247e7dbf961948</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_row"><sp_row action="INSERT_OR_UPDATE"><class_name/><order>1</order><sp_column/><sp_container display_value="Attachments- Test Page - Container 1">ef727254db31220009247e7dbf961947</sp_container><sys_class_name>sp_row</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-09-07 17:19:45</sys_created_on><sys_customer_update>true</sys_customer_update><sys_id>67727254db31220009247e7dbf961948</sys_id><sys_mod_count>0</sys_mod_count><sys_name>1</sys_name><sys_package display_value="Global" source="global">global</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>sp_row_67727254db31220009247e7dbf961948</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-09-07 17:19:45</sys_updated_on></sp_row></record_update>]]></payload>
<remote_update_set display_value="Attachment Widget">10d053dcdb31220009247e7dbf961988</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2016-09-07 19:32:14</sys_created_on>
<sys_id>94d053dcdb31220009247e7dbf961988</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2016-09-07 19:32:14</sys_updated_on>
<table/>
<target_name>1</target_name>
<type>Row</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="Global">global</application>
<category>customer</category>
<comments/>
<name>sp_container_ef727254db31220009247e7dbf961947</name>
<payload><![CDATA[<?xml version="1.0" encoding="UTF-8"?><record_update table="sp_container"><sp_container action="INSERT_OR_UPDATE"><background_color/><background_image/><background_style>default</background_style><bootstrap_alt>false</bootstrap_alt><class_name/><container_class_name/><name>Attachments- Test Page - Container 1</name><order>1</order><sp_page display_value="attachments">ef72b2d0db31220009247e7dbf96193b</sp_page><subheader>false</subheader><sys_class_name>sp_container</sys_class_name><sys_created_by>admin</sys_created_by><sys_created_on>2016-09-07 17:19:45</sys_created_on><sys_customer_update>true</sys_customer_update><sys_id>ef727254db31220009247e7dbf961947</sys_id><sys_mod_count>0</sys_mod_count><sys_name>Attachments- Test Page - Container 1</sys_name><sys_package display_value="Global" source="global">global</sys_package><sys_policy/><sys_replace_on_upgrade>false</sys_replace_on_upgrade><sys_scope display_value="Global">global</sys_scope><sys_update_name>sp_container_ef727254db31220009247e7dbf961947</sys_update_name><sys_updated_by>admin</sys_updated_by><sys_updated_on>2016-09-07 17:19:45</sys_updated_on><width>container</width></sp_container></record_update>]]></payload>
<remote_update_set display_value="Attachment Widget">10d053dcdb31220009247e7dbf961988</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2016-09-07 19:32:14</sys_created_on>
<sys_id>d0d053dcdb31220009247e7dbf961988</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2016-09-07 19:32:14</sys_updated_on>
<table/>
<target_name>Attachments- Test Page - Container 1</target_name>
<type>Container</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
<sys_update_xml action="INSERT_OR_UPDATE">
<action>INSERT_OR_UPDATE</action>
<application display_value="Global">global</application>
<category>customer</category>
<comments/>
<name>sp_widget_2b72b2d0db31220009247e7dbf96193b</name>
<payload>&lt;?xml version="1.0" encoding="UTF-8"?&gt;&lt;record_update table="sp_widget"&gt;&lt;sp_widget action="INSERT_OR_UPDATE"&gt;&lt;client_script&gt;&lt;![CDATA[function($scope, $http) {
	var c = this;
// CODE FOR sn-record-picker
  $scope.tableName = {
    name: 'tableName'
  };		
  $scope.$on("field.change", function(evt, parms) {
    if (parms.field.name == 'tableName'){
			c.data.table = parms.newValue.toString();
			c.server.update();
		}
	});

// CODE FOR input	record
  $scope.getID = function(rec) {
		c.data.record = rec.toString();
    c.server.update();
  }	
	
// CODE FOR fileupload	
	$scope.files = [];	
	$scope.setFiles = function(element) {
		$scope.$apply(function() {
			console.log('files:', element.files);
			// Turn the FileList object into an Array
			for (var i = 0; i &lt; element.files.length; i++) {
				$scope.files.push(element.files[i]);
			}
		});
	};
	
	$scope.removeFiles = function(fname) {
		var index = $scope.files.indexOf(fname);
		if(index&gt;-1)
			$scope.files.splice(index,1);
	};	

	$scope.uploadFiles = function() {	
		$scope.fd = new FormData();
		$scope.files.forEach(function(file){
			$scope.fd.set('files', file);
			var request = {
				method: 'POST',
				url: 'https://&lt;instance-name-here&gt;.service-now.com/api/now/attachment/file?table_name='+c.data.table+'&amp;table_sys_id='+c.data.rec_sysid+'&amp;file_name='+file.name,
				data: $scope.fd.get('files'),
				headers: {
					'Content-Type': file.type,
					'Accept':'application/json'					
				}
			};
			console.log('HTTP request:',request);

			// SEND THE FILES.
			$http(request)
				.success(function (d) {
				// On success code here
			})
				.error(function (err) {
				// On error code here
			});

		});
	}
		
}]]&gt;&lt;/client_script&gt;&lt;controller_as&gt;c&lt;/controller_as&gt;&lt;css&gt;#removeicon:hover{
  cursor:pointer;
  cursor:hand;
}&lt;/css&gt;&lt;data_table&gt;sp_instance&lt;/data_table&gt;&lt;demo_data/&gt;&lt;description/&gt;&lt;docs/&gt;&lt;field_list/&gt;&lt;has_preview&gt;false&lt;/has_preview&gt;&lt;id&gt;attachments&lt;/id&gt;&lt;internal&gt;false&lt;/internal&gt;&lt;link/&gt;&lt;name&gt;Attachments&lt;/name&gt;&lt;option_schema/&gt;&lt;public&gt;false&lt;/public&gt;&lt;roles/&gt;&lt;script&gt;&lt;![CDATA[(function() {
	data.response = '';
	if(input.record){
		var gr = new GlideRecord(input.table);
		gr.addQuery('number',input.record);
		gr.query();
		if(gr.next()){
			data.rec_sysid = gr.sys_id.toString();
			data.response = 'success';
		}
	}

})();]]&gt;&lt;/script&gt;&lt;servicenow&gt;false&lt;/servicenow&gt;&lt;sys_class_name&gt;sp_widget&lt;/sys_class_name&gt;&lt;sys_created_by&gt;admin&lt;/sys_created_by&gt;&lt;sys_created_on&gt;2016-09-07 17:19:45&lt;/sys_created_on&gt;&lt;sys_customer_update&gt;true&lt;/sys_customer_update&gt;&lt;sys_id&gt;2b72b2d0db31220009247e7dbf96193b&lt;/sys_id&gt;&lt;sys_mod_count&gt;45&lt;/sys_mod_count&gt;&lt;sys_name&gt;Attachments&lt;/sys_name&gt;&lt;sys_package display_value="Global" source="global"&gt;global&lt;/sys_package&gt;&lt;sys_policy/&gt;&lt;sys_replace_on_upgrade&gt;false&lt;/sys_replace_on_upgrade&gt;&lt;sys_scope display_value="Global"&gt;global&lt;/sys_scope&gt;&lt;sys_update_name&gt;sp_widget_2b72b2d0db31220009247e7dbf96193b&lt;/sys_update_name&gt;&lt;sys_updated_by&gt;admin&lt;/sys_updated_by&gt;&lt;sys_updated_on&gt;2016-09-07 19:31:33&lt;/sys_updated_on&gt;&lt;template&gt;&lt;![CDATA[&lt;div&gt;
&lt;br/&gt;  Table Name: &lt;sn-record-picker table="'sys_db_object'" display-field="'label'" value-field="'name'" field="tableName" search-fields="'label'" default-query="''" required&gt;&lt;/sn-record-picker&gt;
&lt;br/&gt;  Record Number (eg: INC0000055): &lt;input type='text' ng-model='record' ng-change='getID(record)' required/&gt;  
&lt;br/&gt;&lt;br/&gt;  File: &lt;input type="file" id="fileToUpload" multiple onchange="angular.element(this).scope().setFiles(this)"/&gt;
&lt;br/&gt;      &lt;div ng-show="files.length"&gt;
        &lt;div ng-repeat="file in files.slice(0)"&gt;
            &lt;span&gt;{{file.webkitRelativePath || file.name}}&lt;/span&gt;
            (&lt;span ng-switch="file.size &gt; 1024*1024"&gt;
                &lt;span ng-switch-when="true"&gt;{{file.size / 1024 / 1024 | number:2}} MB&lt;/span&gt;
                &lt;span ng-switch-default&gt;{{file.size / 1024 | number:2}} kB&lt;/span&gt;
            &lt;/span&gt;)&lt;span class="glyphicon glyphicon-remove-circle" id="removeicon" ng-click="removeFiles(file)"&gt;&lt;/span&gt;
        &lt;/div&gt;
        &lt;input type="button" ng-click="uploadFiles()" value="Upload" /&gt;
    &lt;/div&gt;
&lt;/div&gt;]]&gt;&lt;/template&gt;&lt;/sp_widget&gt;&lt;/record_update&gt;</payload>
<remote_update_set display_value="Attachment Widget">10d053dcdb31220009247e7dbf961988</remote_update_set>
<replace_on_upgrade>false</replace_on_upgrade>
<sys_created_by>admin</sys_created_by>
<sys_created_on>2016-09-07 19:32:14</sys_created_on>
<sys_id>d4d053dcdb31220009247e7dbf961988</sys_id>
<sys_mod_count>0</sys_mod_count>
<sys_updated_by>admin</sys_updated_by>
<sys_updated_on>2016-09-07 19:32:14</sys_updated_on>
<table/>
<target_name>Attachments</target_name>
<type>Widget</type>
<update_domain>global</update_domain>
<update_set display_value=""/>
<view/>
</sys_update_xml>
</unload>
